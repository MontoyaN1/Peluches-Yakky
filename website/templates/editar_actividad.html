{% extends 'index.html' %}

{% block title %} Editar Contacto

{% endblock %}

{% block body %}


<div class="fondo" style="min-height: 100vh; padding-top: 20px;">
    <div class="container bg-light rounded-3 p-4 ">

        <div class="d-flex justify-content-between align-items-center mb-5">
            <h1 class="text-black mb-0 display-4 fw-bold">
                Actualizar Actividad
            </h1>

            <div class="d-flex gap-3"><button onclick="window.location.href='/empleado/tabla-actividades'"
                    class="btn btn-primary">
                    <i class="bi bi-arrow-return-left me-2  "></i>Volver
                </button>

            </div>

        </div>

        <form method="post" enctype="multipart/form-data" class="border p-4 rounded-3 shadow-sm">

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Título</label>
                    <input type="text" class="form-control" name="titulo" required value="{{ actividad.titulo}}">
                </div>

                <div class="col-md-3">
                    <label class="form-label">Tipo de actividad*</label>
                    <input type="text" name="actividad" class="form-control" required
                        value="{{ actividad.tipo_actividad }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Descripción</label>
                    <input type="text" class="form-control" name="descripcion" required
                        value="{{ actividad.descripcion }}">
                </div>


            </div>

            <div class="row mb-3">

                <div class="col-md-6">
                    <label class="form-label">Fecha programada</label>
                    <input type="datetime-local" class="form-control" name="fecha" required
                        value="{{ actividad.fecha_programada}}">
                </div>



                <div class="col-md-6">
                    <label class="form-label">Estado (Recuerda que no puedes deshacer los cambios)*</label>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="cambiar_estado" onchange="cambiarEstado()"
                            role="switch">
                        <label class="form-check-label" for="cambiar_estado">
                            <strong>Modificar estado actual</strong>
                        </label>
                    </div>

                    <select name="estado" class="form-select" id="estado_select">
                        <!-- Opciones generadas dinámicamente -->
                    </select>

                    <small class="text-muted" id="estado_mensaje"></small>
                </div>

                <script>
                    function cambiarEstado() {
                        const checkbox = document.getElementById('cambiar_estado');
                        const select = document.getElementById('estado_select');
                        const mensaje = document.getElementById('estado_mensaje');
                        const estadoActual = "{{ actividad.estado }}";

                        if (checkbox.checked) {
                            // MODO EDICIÓN: Permitir selección
                            select.disabled = false;
                            select.classList.remove('bg-light', 'text-muted');
                            mensaje.textContent = 'Selecciona el nuevo estado';
                            mensaje.className = 'text-primary';

                            let opciones = '';
                            if (estadoActual === 'Pendiente') {
                                opciones = `
                <option value="En seguimiento">En seguimiento</option>
                <option value="Completado">Completado</option>
            `;
                            } else if (estadoActual === 'En seguimiento') {
                                opciones = `
                <option value="Completado">Completado</option>
            `;
                            }
                            select.innerHTML = opciones;

                        } else {
                            // MODO VISUALIZACIÓN: Solo mostrar estado actual (pero habilitado)
                            select.disabled = false; // IMPORTANTE: no deshabilitar
                            select.readOnly = true;  // Usar readOnly en lugar de disabled
                            select.classList.add('bg-light', 'text-muted');
                            select.innerHTML = `<option value="${estadoActual}" selected>${estadoActual} (actual)</option>`;
                            mensaje.textContent = 'El estado actual se mantendrá';
                            mensaje.className = 'text-muted';
                        }
                    }

                    // Inicializar
                    document.addEventListener('DOMContentLoaded', function () {
                        document.getElementById('cambiar_estado').checked = false;
                        cambiarEstado();
                    });
                </script>

            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                <button type="submit" class="btn btn-primary px-4 rounded-pill">
                    <i class="bi bi-pencil-square"></i> Actualizar
                </button>


            </div>

        </form>

    </div>
</div>

{% endblock %}